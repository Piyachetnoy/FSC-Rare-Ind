> **⚠️ 重要ルール**: 
> - このファイルは `成果の要旨_PIYACHET.md` を読者が読んだ際の理解を反映する必要があります
> - 情報が不足している部分は「情報不足」と明記してください
> - 追加の文脈や情報を加えないでください
> - このファイルは現在のストーリーテリングの進行状況を追跡するために使用されます

# 成果の要旨：Three-Act構造による物語的まとめ

**研究テーマ**: Few-Shot Counting for Custom Industrial Objects  
**研究者**: PONGSANTICHAI PIYACHET  
**所属**: 茨城工業高等専門学校 専攻科産業技術システムデザイン工学専攻

## Three-Act構造の全体像

```mermaid
graph LR
    A[Act 1: セットアップ] --> B[Act 2: 対立]
    B --> C[Act 3: 解決]
    C --> D[エピローグ]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#e8f5e9
    style D fill:#f3e5f5
```

---

## Act 1: セットアップ — 製造現場の現実

```mermaid
mindmap
  root((Act 1: セットアップ))
    日常的な課題
      部品・材料を数える作業
      自動化の要求の高まり
      物体カウント技術の重要性
    技術の進化と期待
      AI画像処理技術の進化
      様々な手法の実用化
      物体検出・異常検知・セグメンテーション
    従来手法の二つの課題
      課題1：大量の注釈データ依存
        数百〜数千枚の画像準備
        人手による位置・種類の記録
        データ準備のコストと時間
      課題2：実環境での精度低下
        照明条件の変化
        物体の重なり
        背景ノイズ
```

### 日常的な課題
メーカーなどの生産現場における製品検査や品質管理では、部品や材料の管理において「数える」という作業が多く発生する。特に製造業においては、自動化の要求が急速に高まっており、部材の数量管理において物体カウント技術の重要性が増している[1]。

### 技術の進化と期待
こうした背景のもと、人工知能（以下、AI）による画像処理技術は大いに進化し、物体検出、異常検知、画像セグメンテーションなど様々な手法が実用化されてきた。

### 従来手法の二つの課題
しかしながら、このような従来の物体検出によるカウント手法には、大きく二つの課題が存在する。

**第一の課題：大量の注釈データやドメイン依存性**  
新しい製品や環境に対応するたびに、対象物が写った画像を数百から数千枚準備し、それぞれに対して物体の位置や種類を人手で記録する必要がある[2]。このため、多様な工業製品を扱う現場では、データ準備のコストと時間が大きな障壁となり、適応が困難である。

**第二の課題：実環境における正確性と信頼性の問題**  
生産ラインなど、部品が流れてくる照明の当て方と配置角度が厳密に管理されている環境では一定の性能が得られるものの、室外や倉庫などの現場環境では、照明条件の変化、物体の重なり、背景ノイズなどにより、その精度は大きく低下する。

このような課題に対して、少数のサンプル画像のみで学習できる基盤モデルおよび、AIの出力を人間が確認・修正するHuman in the Loopの思考に基づくワークフローが必要であると考える[4][6]。

---

## Act 2: 対立 — 従来技術の限界

```mermaid
graph TD
    A[従来のカウント手法] --> B[第一の課題<br/>大量の注釈データ依存]
    A --> C[第二の課題<br/>実環境での精度低下]
    
    B --> B1[数百〜数千枚の画像準備]
    B --> B2[人手による位置・種類の記録]
    B1 --> B3[データ準備のコスト・時間が障壁]
    B2 --> B3
    
    C --> C1[照明条件の変化]
    C --> C2[物体の重なり]
    C --> C3[背景ノイズ]
    C1 --> C4[精度が大きく低下]
    C2 --> C4
    C3 --> C4
    
    B3 --> E[多様な工業製品現場への適応困難]
    C4 --> E
    
    E --> F[求められる解決策]
    F --> G[少数のサンプル画像のみで<br/>学習できる基盤モデル]
    F --> H[AIの出力を人間が確認・修正する<br/>Human in the Loopワークフロー]
    
    style A fill:#ffebee
    style B fill:#ffcdd2
    style C fill:#ffcdd2
    style E fill:#ef9a9a
    style F fill:#fff9c4
    style G fill:#c8e6c9
    style H fill:#c8e6c9
```

### 第一の課題：大量の注釈データ依存とドメイン依存性
従来の物体検出によるカウント手法は、大量の注釈データやドメイン依存性を前提としている[2]。すなわち、新しい製品や環境に対応するたびに、対象物が写った画像を数百から数千枚準備し、それぞれに対して物体の位置や種類を人手で記録する必要がある。このため、多様な工業製品を扱う現場では、データ準備のコストと時間が大きな障壁となり、適応が困難である。

### 第二の課題：実環境における正確性と信頼性の問題
生産ラインなど、部品が流れてくる照明の当て方と配置角度が厳密に管理されている環境では一定の性能が得られるものの、室外や倉庫などの現場環境では、照明条件の変化、物体の重なり、背景ノイズなどにより、その精度は大きく低下する。

### 求められる解決策
このような課題に対して、少数のサンプル画像のみで学習できる基盤モデルおよび、AIの出力を人間が確認・修正するHuman in the Loopの思考に基づくワークフローが必要であると考える[4][6]。

---

## Act 3: 解決 — Few-Shot Countingによる革新

```mermaid
flowchart TD
    A[研究の目的] --> B[工業物体に適用可能な<br/>カウント手法とワークフローの最適化]
    B --> C[性能と実環境への<br/>応用可能性の検証]
    
    D[Few-Shot Counting<br/>FSC] --> E[数枚の参照画像のみで<br/>同種の物体をカウント]
    D --> F[少数データからの<br/>汎化能力]
    
    E --> G[現場適応型<br/>アプローチ]
    F --> G
    
    G --> H[形状が複雑な環境対応]
    G --> I[背景ノイズの多い環境対応]
    G --> J[多様な状況への適応]
    
    H --> K[Human in the Loop<br/>ワークフロー]
    I --> K
    J --> K
    
    K --> L[AIによるカウント結果]
    L --> M[人間が確認・修正]
    M --> N[最終判断]
    
    A --> O[学際的展開]
    C --> O
    N --> O
    O --> P[産業技術分野への貢献]
    O --> Q[人間工学など他分野への応用]
    
    style A fill:#c8e6c9
    style D fill:#a5d6a7
    style G fill:#81c784
    style K fill:#66bb6a
    style O fill:#4caf50
```

### 研究の目的
本学修・探究の目的は、工業物体に適用可能なカウント手法とワークフローを最適化し、その性能と実環境への応用可能性を検証することである。ここでいう「工業物体（Industrial Objects）」とは、鋼材や部品など製造現場で扱われる対象物を指し、「ワークフロー」とは、AIによるカウント結果を人間が確認・修正し、最終判断を下すまでの一連の作業手順を意味する。

### 突破口の発見：Few-Shot Counting（FSC）
上記の二つの課題を克服するため、少数データからの汎化能力に優れたFew-Shot Counting（FSC）に着目した[3][4]。FSCは、従来手法とは異なり、カウント対象の物体が写った参照画像を数枚用意するだけで、画像中の同種の物体を数えることができる技術である。

### 現場適応型アプローチの構築
このFSCを基盤としつつ、形状が複雑で背景ノイズの多い現場環境においても、わずかなサンプル画像から学習し、多様な状況に適応できる現場適応型のカウント手法およびそのワークフローを構築したいと考えている。

### 学際的展開の可能性
こうした課題に対応する技術として、本テーマは産業技術分野の一助となるだけでなく、人間工学など他分野への応用も視野に入れた学際的展開が可能であり、学修の集大成にふさわしいと判断した。

---

## エピローグ：学修の集大成として

こうした課題に対応する技術として、本テーマは産業技術分野の一助となるだけでなく、人間工学など他分野への応用も視野に入れた学際的展開が可能であり、学修の集大成にふさわしいと判断した。

---

# 研究の手法・方法論

本研究は、データセット構築、モデル開発、性能検証の三段階で構成される。

```mermaid
flowchart LR
    A[研究の手法] --> B[データセット構築]
    A --> C[モデル開発]
    A --> D[性能検証]
    
    B --> B1[INDT-576<br/>576画像]
    B --> B2[INDT-409<br/>409画像]
    B1 --> B3[4種類の工業部材]
    B2 --> B3
    B3 --> B4[T形鋼・L形鋼<br/>I形鋼・角棒]
    B4 --> B5[Roboflow Universe<br/>から収集]
    B5 --> B6[PBATツールで<br/>アノテーション]
    
    C --> C1[FamNetを<br/>基盤モデルとして採用]
    C1 --> C2[ResNet-50による<br/>特徴抽出]
    C1 --> C3[相関マップによる<br/>密度推定]
    C2 --> C4[参照画像との<br/>類似性に基づく計数]
    C3 --> C4
    C4 --> C5[Pretrainedモデル]
    C4 --> C6[ファインチューニング<br/>モデル]
    C5 --> C7[後処理による<br/>誤検出低減]
    C6 --> C7
    C7 --> C8[Scikit-Imageによる<br/>ピーク検出]
    C8 --> C9[幾何学的特徴による<br/>絞り込み]
    C9 --> C10[ハイブリッド<br/>アプローチ]
    
    D --> D1[テストセット評価]
    D --> D2[FSC-147<br/>ベンチマーク評価]
    D1 --> D3[ドメイン内<br/>汎化性能]
    D2 --> D4[ドメイン間<br/>汎化性能]
    D3 --> D5[MAE・RMSE評価]
    D4 --> D5
    D5 --> D6[Human-in-the-Loop<br/>ワークフロー設計]
    D6 --> D7[信頼度スコア算出]
    D7 --> D8[密度マップ局所分散値]
    D7 --> D9[参照画像との相関値]
    D8 --> D10[閾値未満のみ<br/>人間確認]
    D9 --> D10
    D10 --> D11[4つの比較手法]
    D11 --> D12[完全自動化]
    D11 --> D13[全数確認]
    D11 --> D14[ランダム<br/>サンプリング]
    D11 --> D15[適応的HITL<br/>提案手法]
    D12 --> D16[精度と効率の<br/>トレードオフ検証]
    D13 --> D16
    D14 --> D16
    D15 --> D16
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#e8f5e9
    style D fill:#f3e5f5
    style C10 fill:#66bb6a
    style D16 fill:#66bb6a
```

## データセット構築

工業物体に特化したデータセットINDT-576（576画像）およびその部分集合INDT-409（409画像）を構築した。対象物として、形状が類似し識別が困難なT形鋼、L形鋼、I形鋼、角棒の4種類の工業部材を選定し、公開データソースRoboflow Universeから画像を収集した。アノテーション作業では、独自開発したツールPBATを用いてFSCモデルの学習に適したデータ形式への変換を行い、各物体の位置情報を効率的に付与した。

## モデル開発

```mermaid
graph TD
    A[FamNet基盤モデル] --> B[ResNet-50<br/>特徴抽出層]
    A --> C[相関マップ<br/>密度推定層]
    
    B --> D[参照画像との<br/>類似性計算]
    C --> D
    
    D --> E[Pretrainedモデル]
    D --> F[ファインチューニング<br/>モデル]
    
    E --> G[密度マップ出力]
    F --> G
    
    G --> H[後処理]
    H --> I[Scikit-Image<br/>ピーク検出]
    I --> J[幾何学的特徴<br/>絞り込み]
    
    J --> K[ハイブリッド<br/>アプローチ]
    K --> L[深層学習による<br/>特徴学習]
    K --> M[ルールベースの<br/>解釈可能な判断]
    
    style A fill:#c8e6c9
    style K fill:#66bb6a
    style L fill:#a5d6a7
    style M fill:#a5d6a7
```

FSC手法の一つであるFamNet[3]を基盤モデルとして採用した。FamNetは、ResNet-50による特徴抽出層と相関マップによる密度推定層から構成され、数枚の参照画像（Exemplars）との類似性に基づいて対象物を計数する。学習には、FamNetの事前学習済みモデル（Pretrainedモデル）をINDTデータセットで再学習（ファインチューニング）したモデルを構築し、比較対象として元のPretrainedモデルとの性能差を検証した。

さらに、FamNetの密度マップ出力に対して後処理を施し、背景ノイズや物体の重なりによる誤検出を低減した。具体的には、画像処理ライブラリScikit-Image[5]のピーク検出アルゴリズムを適用して物体中心の候補点を抽出し、幾何学的特徴に基づく規則的な絞り込みを行った。これにより、深層学習による特徴学習と、ルールベースの解釈可能な判断を統合したハイブリッドアプローチを実現した。

## 性能検証

```mermaid
flowchart TD
    A[性能検証] --> B[テストセット<br/>INDTから分割]
    A --> C[ベンチマーク<br/>FSC-147]
    
    B --> D[ドメイン内<br/>汎化性能]
    C --> E[ドメイン間<br/>汎化性能]
    
    D --> F[評価指標]
    E --> F
    F --> G[MAE<br/>平均絶対誤差]
    F --> H[RMSE<br/>平均二乗誤差の平方根]
    
    G --> I[Human-in-the-Loop<br/>ワークフロー設計]
    H --> I
    
    I --> J[信頼度スコア算出]
    J --> K[密度マップ<br/>局所分散値]
    J --> L[参照画像との<br/>相関値]
    
    K --> M[閾値判定]
    L --> M
    M --> N[閾値未満:<br/>人間確認・修正]
    M --> O[閾値以上:<br/>自動判定]
    
    N --> P[4つの比較手法]
    O --> P
    P --> Q[完全自動化]
    P --> R[全数確認]
    P --> S[ランダム<br/>サンプリング]
    P --> T[適応的HITL<br/>提案手法]
    
    Q --> U[トレードオフ検証]
    R --> U
    S --> U
    T --> U
    U --> V[MAE測定]
    U --> W[人間介入率測定]
    U --> X[処理時間測定]
    
    V --> Y[精度と効率の<br/>トレードオフ曲線]
    W --> Y
    X --> Y
    Y --> Z[実務での<br/>最適運用点]
    
    style A fill:#e1f5ff
    style I fill:#fff4e1
    style U fill:#e8f5e9
    style Z fill:#66bb6a
```

構築した両モデルをINDTデータセットから事前に分割したテストセット（学習時には使用していない未見の画像）および工業物体以外の多様な対象を含むベンチマークデータセットFSC-147[3]に適用し、ドメイン内およびドメイン間での汎化性能を評価した。評価指標には、平均絶対誤差（MAE）および平均二乗誤差の平方根（RMSE）を用いた。

さらに、実務での運用を想定し、Human-in-the-Loopのワークフローを設計した[6]。このワークフローでは、密度マップの局所分散値と参照画像との相関値を組み合わせた信頼度スコアを算出し、このスコアが閾値未満の画像のみを人間が確認・修正する仕組みを実装した。ワークフローの有効性検証では、(1)完全自動化、(2)全数確認、(3)ランダムサンプリング、(4)提案手法（適応的HITL）の4つの比較手法を設定し、それぞれについてMAE、人間介入率、処理時間を測定した。信頼度閾値を段階的に変化させることで精度と効率のトレードオフ曲線を描き、実務での最適な運用点を明らかにした。

## 実装

実装にはPythonおよび深層学習フレームワークPyTorchを用い、最終的な成果物として、学術論文、ソースコード、データセットをGitHubリポジトリで公開した。

---

# 得られた結果と考察，将来展望

## モデル性能の検証結果

```mermaid
flowchart TD
    A[モデル性能検証] --> B[ファインチューニングモデル]
    A --> C[Pretrainedモデル]
    
    B --> D[INDTテストセット]
    C --> D
    D --> E[MAE改善を確認]
    E --> F[ドメイン特化型学習の有効性]
    
    B --> G[FSC-147ベンチマーク]
    C --> G
    G --> H[性能やや低下傾向]
    H --> I[ドメイン適応と汎化性能の<br/>トレードオフ存在]
    
    style A fill:#e1f5ff
    style F fill:#c8e6c9
    style I fill:#fff4e1
```

INDTデータセットでファインチューニングを行ったモデルは、事前学習済みモデル（Pretrainedモデル）と比較して、工業物体のカウントタスクにおいて優れた性能を示した。具体的には、テストセットにおけるMAEが改善し、ドメイン特化型の学習が有効であることが確認された。一方、汎用ベンチマークFSC-147では、ファインチューニングモデルの性能がやや低下する傾向が見られ、ドメイン適応と汎化性能のトレードオフが存在することが示唆された。

## ワークフロー比較検証結果

```mermaid
flowchart TD
    A[4種類のワークフロー比較] --> B[完全自動化]
    A --> C[全数確認]
    A --> D[ランダムサンプリング]
    A --> E[提案手法<br/>適応的HITL]
    
    B --> B1[処理時間: 最短]
    B --> B2[精度面での信頼性に限界]
    
    C --> C1[誤判定を完全に防止]
    C --> C2[処理時間: 最長]
    
    D --> D1[一定割合を無作為抽出]
    D --> D2[精度と効率の中間的性能]
    
    E --> E1[信頼度スコアに基づく<br/>選択的確認]
    E --> E2[確信度が低い画像のみ<br/>人間が確認]
    
    B1 --> F[運用場面に応じた<br/>適切な手法選択が必要]
    B2 --> F
    C1 --> F
    C2 --> F
    D1 --> F
    D2 --> F
    E1 --> F
    E2 --> F
    
    F --> G[適応的HITLの優位性]
    G --> G1[精度と効率のバランス]
    G --> G2[厳密な精度が不要な場面で<br/>効率的運用が可能]
    
    style A fill:#e1f5ff
    style E fill:#c8e6c9
    style F fill:#fff4e1
    style G fill:#66bb6a
```

構築したファインチューニングモデルを用いて、4種類のワークフローを比較検証した。各手法の特性は以下のとおりである。

**(1) 完全自動化**: 処理時間は最短であるが、モデルの誤判定をそのまま出力するため、精度面での信頼性に限界がある。

**(2) 全数確認**: すべての出力を人間が確認するため、モデルの誤判定を完全に防止できるが、処理時間が最も長くなる。

**(3) ランダムサンプリング**: 一定割合の画像を無作為に抽出して確認する手法であり、精度と効率の中間的な性能を示す。

**(4) 提案手法（適応的HITL）**: 信頼度スコアに基づき、モデルの確信度が低い画像のみを選択的に人間が確認する。

上記の結果から、最適なワークフローは一意に決まるものではなく、運用場面に応じて適切な手法を選択すべきであることが明らかとなった。提案する適応的HITLは、信頼度の閾値設定に依存するものの、精度と効率のバランスにおいて優位性を示した。特に、厳密な数値精度が求められない場面では、完全自動化や全数確認よりも効率的な運用が可能である。

## 将来展望

```mermaid
flowchart LR
    A[本研究の成果] --> B[製造現場における<br/>数量管理システムの自動化]
    
    B --> C[今後の課題]
    C --> C1[信頼度閾値の<br/>自動調整機構の導入]
    C --> C2[より多様な工業物体への<br/>適用範囲の拡大]
    
    B --> D[HITLの枠組みの意義]
    D --> D1[AIによる判断を<br/>人間が監督・補完]
    D --> D2[今後のAI活用における<br/>重要なパラダイム]
    
    D1 --> E[幅広い分野への適用]
    D2 --> E
    E --> E1[製造業]
    E --> E2[医療診断]
    E --> E3[自動運転]
    
    E1 --> F[AIの出力をどの程度信頼し<br/>どの場面で人間が介入すべきか]
    E2 --> F
    E3 --> F
    
    style A fill:#e1f5ff
    style B fill:#c8e6c9
    style D fill:#fff4e1
    style F fill:#66bb6a
```

本研究の成果は、製造現場における数量管理システムの自動化に寄与するものである。今後は、信頼度閾値の自動調整機構の導入や、より多様な工業物体への適用範囲の拡大が課題となる。また、本研究で提案したHuman-in-the-Loopの枠組みは、AIによる判断を人間が監督・補完するという、今後のAI活用における重要なパラダイムを示唆している。AIの出力をどの程度信頼し、どの場面で人間が介入すべきかという問いは、製造業に限らず、医療診断や自動運転など幅広い分野に共通する課題であり、本研究の知見がその議論に貢献することを期待する。

---

# 不足情報

以下のセクションは、元のファイル `成果の要旨_PIYACHET.md` では「[空白]」となっており、読者にとって情報が不足している部分です。

## 履修計画書からの変更

**情報不足**: 元のファイルでは「[空白]」となっており、履修計画書から変更があった場合の理由および履修計画書に対する評価・コメントへの対応については記載されていない。

## 学修全体について

**情報不足**: 元のファイルでは以下のセクションがすべて「[空白]」となっている：
- テーマの学修・探究の基盤となる専門科目の学修
- テーマの学修・探究に関係する関連科目の学修
- 専攻に係る科目以外の学修
- 自分自身の４年間の学修全体の省察

読者は、この研究がどのような学修の基盤の上に成り立っているか、どのような関連科目と結びついているかについては情報が不足している。

---

# 参考文献

[1] E. Brynjolfsson and A. McAfee, The second machine age: Work, progress, and prosperity in a time of brilliant technologies. WW Norton & company, 2014.

[2] S. Aich and I. Stavness, 'Improving object counting with heatmap regulation', arXiv preprint arXiv:1803. 05494, 2018.

[3] V. Ranjan, U. Sharma, T. Nguyen, and M. Hoai, "Learning to count everything", in Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition, 2021, pp. 3394–3403.

[4] A. Parnami and M. Lee, "Learning from few examples: A summary of approaches to few-shot learning", arXiv preprint arXiv:2203. 04291, 2022.

[5] S. Van der Walt et al., "scikit-image: image processing in Python", PeerJ, vol. 2, p. e453, 2014.

[6] J. Jakubik, P. Hemmer, M. Vössing, B. Blumenstiel, A. Bartos, and K. Mohr, "Designing a human-in-the-loop system for object detection in floor plans", in Proceedings of the AAAI Conference on Artificial Intelligence, 2022, vol. 36, pp. 12524–12530.
